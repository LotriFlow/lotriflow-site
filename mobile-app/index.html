<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta
      name="description"
      content="LotriFlow Quit Pro - Quit Smoking Tracker & Coach. Track your journey with LotriFlow's smoke-free tools."
    />

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-title" content="LotriFlow Quit Pro" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="LotriFlow Quit" />
    <meta name="msapplication-TileColor" content="#0a0a0f" />
    <meta name="theme-color" content="#0a0a0f" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="color-scheme" content="dark light" />

    <title>LotriFlow Quit Pro - Quit Smoking Tracker & Coach</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="512x512" href="assets/icon-512x512.png" />
    <link rel="shortcut icon" href="assets/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png" />
    <!-- The 192x192 icon is often used for PWA manifests -->
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icon-192x192.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="src/styles.css?v=15" />
    <link rel="stylesheet" href="milestone-styles.css" />

  </head>
  <body>
    <!-- Immediately apply Pro status from cache to prevent flash -->
    <script>
      (function() {
        const isProActive = localStorage.getItem('lotriflow_pro_status') === 'true';
        if (isProActive) {
          document.body.classList.add('pro-active');
        }
      })();
    </script>
    <div class="offline-banner" id="offlineBanner">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path><path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path><path d="M1.42 9a16 16 0 0 1 4.7-2.88"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12" y2="20"></line></svg> You're offline - Changes will sync when connected
    </div>
    <div class="bg-animation"></div>
    <div class="breath-circle"></div>
    <div class="breath-circle"></div>
    <div class="breath-circle"></div>

    <!-- Header -->
    <header class="header">
      <div class="logo"><span class="logo-text">Quit Smoking Coach</span></div>
      <div class="header-controls">
        <button
          class="header-btn"
          id="themeBtn"
          onclick="toggleTheme()"
          title="Toggle Theme"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
        <button
          class="header-btn"
          id="settingsBtn"
          onclick="toggleSettings()"
          title="Settings"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
      </div>
    </header>

    <div class="app-container">
      <!-- Home Section -->
      <div class="section active" id="homeSection">

      <!-- Timer Display -->
      <div class="timer-display" id="timerDisplay">
        <button
          class="timer-maximize-btn"
          id="maximizeIcon"
          onclick="toggleTimerMaximize()"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
        </button>
        <div class="timer-label">
          <span class="dot"></span>
          <span>QUIT TIMER</span>
        </div>
        <div class="timer-digits" id="timerDigits">
          <span class="time-segment"
            ><span class="value" id="days">0</span
            ><span class="unit">d</span></span
          >
          <span class="time-segment"
            ><span class="value" id="hours">00</span
            ><span class="unit">h</span></span
          >
          <span class="time-segment"
            ><span class="value" id="minutes">00</span
            ><span class="unit">m</span></span
          >
          <span class="time-segment"
            ><span class="value" id="seconds">00</span
            ><span class="unit">s</span></span
          >
        </div>
        <div class="timer-subtext" id="timerSubtext">
          Your body is already healing
        </div>
      </div>

      <!-- Timer Maximize Overlay -->
      <div
        class="timer-overlay"
        id="timerOverlay"
        onclick="toggleTimerMaximize()"
      ></div>

      <!-- Next Milestone Card -->
      <div class="next-milestone" id="nextMilestoneCard" onclick="showSection('milestones')">
        <div class="next-milestone-icon" id="nextMilestoneIcon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
        <div class="next-milestone-content">
          <div class="next-milestone-label">Next Milestone</div>
          <div class="next-milestone-title" id="nextMilestoneTitle">Heart Rate Stabilizes</div>
          <div class="next-milestone-progress">
            <div class="next-milestone-progress-bar" id="nextMilestoneBar"></div>
          </div>
        </div>
        <div class="next-milestone-percent" id="milestonePercent">0%</div>
      </div>

      <!-- Main Action -->
      <button class="main-action-btn" onclick="logCigarette()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cigarette-icon">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        <span id="smokeBtnText">I Smoked</span>
      </button>

      <!-- Key Stats - Minimal -->
      <div class="key-stats">
        <div class="key-stat">
          <div class="key-stat-value" id="moneySaved">$0</div>
          <div class="key-stat-label">Money Saved</div>
          <div class="key-stat-subtext" id="moneySavedSubtext"></div>
        </div>
        <div class="key-stat-divider"></div>
        <div class="key-stat">
          <div class="key-stat-value" id="todaysCount">0/0</div>
          <div class="key-stat-label">Smoked Today</div>
          <div class="key-stat-subtext" id="todaysBaselineSubtext"></div>
        </div>
        <div class="key-stat-divider"></div>
        <div class="key-stat">
          <div class="key-stat-value" id="dayStreak">0</div>
          <div class="key-stat-label">Day Streak</div>
          <div class="key-stat-subtext" id="streakSubtext"></div>
        </div>
      </div>

      </div> <!-- End Home Section -->

      <!-- Bottom Navigation -->
      <div class="bottom-nav">
        <div class="nav-tabs bottom-nav-tabs">
          <button class="nav-tab active" onclick="showHome()">
            <span class="nav-tab-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9,22 9,12 15,12 15,22"></polyline></svg>
            </span>
            <span>Home</span>
          </button>
          <button
            class="nav-tab pro-nav-feature"
            data-pro-feature-name="Advanced Reports & Analytics"
            onclick="showSection('reports')"
          >
            <span class="nav-tab-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
            </span>
            <span>Reports</span>
          </button>
          <button class="nav-tab" onclick="showSection('coach')">
            <span class="nav-tab-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
            </span>
            <span>Coach</span>
          </button>
          <button class="nav-tab" onclick="showSection('quitPlan')">
            <span class="nav-tab-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v6"></path><path d="M6 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"></path></svg>
            </span>
            <span>Plan</span>
          </button>
          <button
            class="nav-tab pro-nav-feature"
            data-pro-feature-name="Craving Tracker & Pattern Analysis"
            onclick="showSection('cravings')"
          >
            <span class="nav-tab-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20V8m6 12V4m6 16v-8m4 8H2"/></svg>
            </span>
            <span>Cravings</span>
          </button>
          <button class="nav-tab" onclick="showSection('milestones')">
            <span class="nav-tab-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
            </span>
            <span>Health</span>
          </button>
        </div>
      </div>

      <!-- Reports Section -->
        <div class="section pro-feature" id="reportsSection" data-pro-feature-name="Advanced Reports & Analytics">
        <div class="u-flex-end-row">
          <button class="btn btn-secondary u-btn-compact" onclick="showSection('achievements')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"></polyline></svg> View Badges
          </button>
        </div>
        <!-- Progression Metrics -->
        <div class="progression-metrics">
          <div class="metric-card">
            <div class="metric-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path></svg> Total Smoked</div>
            <div class="metric-value" id="totalSmoked">0</div>
            <div class="metric-subtext" id="smokedSinceStart">since you started tracking</div>
          </div>

          <div class="metric-card">
            <div class="metric-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.93"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Avoided</div>
            <div class="metric-value" id="totalAvoided">0</div>
            <div class="metric-subtext" id="avoidedPercentage">
              tracking against your limit
            </div>
          </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-overview u-mt-16">
          <!-- Trend Card -->
          <div class="overview-card trend-card">
            <div class="trend-icon" id="trendIcon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg></div>
            <div class="trend-content">
              <div class="trend-label">7-Day Trend</div>
              <div class="trend-value" id="trendValue">Analyzing...</div>
              <div class="trend-change" id="trendChange"></div>
            </div>
          </div>

          <!-- Daily Average Card -->
          <div class="overview-card stat-card">
            <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg></div>
            <div class="stat-value" id="dailyAverage">0.0</div>
            <div class="stat-label">
              Overall Daily Avg
              <span class="info-icon" title="Your average cigarettes per day since you started tracking. Compare this to your baseline to see progress." onclick="showInfoTooltip(event)">‚ìò</span>
            </div>
          </div>

          <!-- Avg Interval Card -->
          <div class="overview-card stat-card">
            <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></div>
            <div class="stat-value" id="avgInterval">--</div>
            <div class="stat-label">
              Avg Interval
              <span class="info-icon" title="Average time between logged cigarettes. Helps track your progress in spacing out smoking." onclick="showInfoTooltip(event)">‚ìò</span>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Daily Cigarettes</div>
            <div class="chart-controls">
              <button class="chart-view-btn active" data-days="7" onclick="changeChartView(7)">7D</button>
              <button class="chart-view-btn pro-feature" data-days="14" data-pro-feature-name="Advanced Analytics" onclick="changeChartView(14)">14D</button>
              <button class="chart-view-btn pro-feature" data-days="30" data-pro-feature-name="Advanced Analytics" onclick="changeChartView(30)">30D</button>
            </div>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-color legend-zero"></div>
              <span>Zero</span>
            </div>
            <div class="legend-item">
              <div class="legend-color legend-under"></div>
              <span>Under</span>
            </div>
            <div class="legend-item">
              <div class="legend-color legend-over"></div>
              <span>Over</span>
            </div>
          </div>
          <div class="bar-chart" id="barChart"></div>
        </div>
        <div class="summary-row">
          <div class="summary-card">
            <div class="summary-value" id="reportTotal">0</div>
            <div class="summary-label">Total</div>
          </div>
          <div class="summary-card">
            <div class="summary-value" id="reportAvg">0</div>
            <div class="summary-label">Daily Avg</div>
          </div>
          <div class="summary-card">
            <div class="summary-value" id="reportBest">0</div>
            <div class="summary-label">Best Day</div>
          </div>
        </div>
          <button
            class="main-action-btn btn-ready pro-feature u-mt-12"
            data-pro-feature-name="Share Progress"
            onclick="showShareModal()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cigarette-icon"><polyline points="16 16 12 12 8 16"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"></path></svg> 
            <span>Share Progress</span>
          </button>
      </div>

      <!-- Achievements Section -->
      <div class="section" id="achievementsSection">
        <div class="section-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"></polyline></svg> Your Achievements</div>

        <!-- How Badges Work -->
        <div class="u-card-info">
          <div class="u-flex-center-8 u-mb-8 u-fw-600">
            <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></span>
            <span>How Badges Work</span>
          </div>
          <div class="u-text-body">
            <strong>Time-based:</strong> Earned after specific hours/days smoke-free (First Hour, Day One, Week Warrior)<br>
            <strong>Money saved:</strong> Based on cigarettes avoided √ó cost per cigarette<br>
            <strong>Cigarettes avoided:</strong> Calculated from your reduction vs. baseline smoking rate<br>
            <strong>Under-limit streak:</strong> Consecutive days staying under your daily limit<br>
            <strong>Smoke-free streak:</strong> Consecutive days with ZERO cigarettes
          </div>
        </div>

        <!-- Badge Progress Stats -->
        <div class="badge-stats">
          <div class="badge-stat-card">
            <div class="badge-stat-value" id="badgesUnlocked">0</div>
            <div class="badge-stat-label">Unlocked</div>
          </div>

          <div class="badge-stat-card">
            <div class="badge-stat-value" id="badgesTotal">15</div>
            <div class="badge-stat-label">Total</div>
          </div>

          <div class="badge-stat-card">
            <div class="badge-stat-value" id="badgesPercent">0%</div>
            <div class="badge-stat-label">Complete</div>
          </div>
        </div>

        <!-- Next Badge -->
        <div class="next-badge-card" id="nextBadgeCard">
          <div class="next-badge-header"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"></polyline></svg> Next Badge</div>
          <div class="next-badge-content">
            <div class="next-badge-icon" id="nextBadgeIcon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"></polyline></svg></div>
            <div class="next-badge-info">
              <div class="next-badge-title" id="nextBadgeTitle">First Hour</div>
              <div class="next-badge-progress" id="nextBadgeProgress">
                45 minutes to go
              </div>
            </div>
          </div>
        </div>

        <div class="achievements-grid" id="achievementsGrid"></div>
      </div>

      <!-- Coach Section -->
      <div class="section" id="coachSection">
        <div class="coach-card">
          <div class="coach-header">
            <div class="coach-avatar"><img src="assets/icons/support.svg" alt="" /></div>
            <div>
              <div class="coach-name">Your Coach</div>
              <div class="coach-status" id="coachStatus">
                Here to support you
              </div>
            </div>
          </div>

          <div class="coach-message" id="coachMessage">
            <img src="assets/icons/target.svg" alt="" class="inline-icon"> Welcome! I'm your personal quit coach. I'll give you contextual
            guidance based on where you are in your journey. Check back often
            for personalized support!
          </div>

          <!-- AI Chat Input -->
          <div
            class="coach-chat-input u-mt-16 u-hidden"
          >
            <input
              type="text"
              id="coachChatInput"
              placeholder="Ask me anything... (e.g., 'How do I handle cravings?')"
              class="u-input-surface"
              onkeypress="if(event.key==='Enter') askAICoach()"
            />
            <button
              class="btn u-mt-8 u-w-full"
              onclick="askAICoach()"
            >
              <img src="assets/icons/chat.svg" alt="" class="inline-icon"> Ask Coach
            </button>
          </div>

          <!-- Quick Actions -->
                    <div class="coach-quick-actions">
            <button class="main-action-btn btn-ready" onclick="showBreathingSelector()">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cigarette-icon"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path></svg> <span>Start Breathing Exercise</span>
            </button>
          </div>
        </div>

        <div class="motivation-card">
          <div class="motivation-quote" id="quote">
            "Every cigarette you don't smoke is a victory."
          </div>
        <div class="motivation-author" id="quoteAuthor">
            ‚Äî Your Future Self
          </div>
        </div>
      </div>

      <!-- Cravings Section -->
      <div class="section pro-feature" id="cravingsSection" data-pro-feature-name="Craving Tracker & Pattern Analysis">
        <div class="section-title">
          <img src="assets/icons/bar-chart.svg" alt="" class="inline-icon" /> Cravings Log
          <span class="pro-badge">PRO</span>
        </div>
        <div class="cravings-card">
          <div class="cravings-intro">
            Track what sparks cravings and what helped so you can spot patterns and stay ahead.
          </div>
          <div class="cravings-inputs">
            <div class="cravings-field">
              <label for="cravingTriggerInput">Trigger</label>
              <input
                type="text"
                id="cravingTriggerInput"
                placeholder="E.g., stress, coffee, after meals, social"
              />
            </div>
            <div class="cravings-field">
              <label for="cravingNotesInput">Notes</label>
              <textarea
                id="cravingNotesInput"
                rows="3"
                placeholder="What did you feel? What helped you ride it out?"
              ></textarea>
            </div>
          </div>
          <div class="cravings-quick-triggers" role="group" aria-label="Quick craving triggers">
            <button type="button" class="craving-chip" onclick="logCraving('Stress / anxiety')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
              <span>Stress</span>
            </button>
            <button type="button" class="craving-chip" onclick="logCraving('After meals')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></svg>
              <span>After meals</span>
            </button>
            <button type="button" class="craving-chip" onclick="logCraving('Coffee or caffeine')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>
              <span>Coffee</span>
            </button>
            <button type="button" class="craving-chip" onclick="logCraving('Social / friends')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
              <span>Social</span>
            </button>
            <button type="button" class="craving-chip" onclick="logCraving('Boredom')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
              <span>Boredom</span>
            </button>
          </div>
          <button
            class="main-action-btn btn-ready u-w-full u-mt-8"
            onclick="logCraving()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cigarette-icon"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            <span>Log Craving</span>
          </button>
        </div>

        <!-- Craving Pattern Analysis -->
        <div class="section-title u-mt-24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg> Pattern Insights</div>
        <div id="cravingPatterns" class="pattern-insights">
          <!-- Patterns will be rendered here -->
        </div>

        <div class="cravings-subtitle">Recent entries</div>
        <div class="cravings-list" id="cravingsList"></div>
      </div>

      <!-- Milestones Section -->
      <div class="section" id="milestonesSection">
        <div class="section-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg> Health Recovery Timeline</div>
        <div id="milestonesList"></div>
        <div class="health-disclaimer">
          ‚öïÔ∏è <strong>Health Disclaimer:</strong> These recovery timelines are educational estimates based on general medical research. Individual results vary significantly based on personal health history, smoking duration, and other factors. This app provides motivational information only and does not provide medical advice, diagnosis, or treatment. Always consult your healthcare provider before making health decisions.
        </div>
      </div>
      <!-- Quit Plan Section (moved from modal) -->
      <div class="section" id="quitPlanSection">
        <div class="section-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg> Your Quit Plan</div>
        <div class="quit-plan-view-toggle" style="margin-bottom:12px; display:flex; align-items:center; gap:8px;">
          <label style="font-size:0.9rem; color:var(--text-secondary);">View:</label>
          <select id="quitPlanGranularity" aria-label="Quit plan view" onchange="changeQuitPlanGranularity()">
            <option value="key">Key Milestones</option>
            <option value="every2">Every 2 Days</option>
            <option value="daily">Daily Steps</option>
          </select>
        </div>
        <div class="quit-plan-subtitle" id="quitPlanSubtitle">Your personalized roadmap to freedom</div>
        <div class="quit-plan-summary" id="quitPlanSummary" style="margin:10px 0;"></div>
        <ul class="quit-plan-steps" id="quitPlanSteps" style="padding-left:18px; line-height:1.5"></ul>
      </div>
    </div>

    <!-- Install Banner -->
    <div class="install-banner" id="installBanner">
      <span class="install-banner-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg></span>
      <div class="install-banner-text">
        <div class="install-banner-title">Install LotriFlow Quit</div>
        <div class="install-banner-desc">
          Add to home screen for the best experience
        </div>
      </div>
      <button class="install-banner-btn" onclick="installPWA()">Install</button>
      <button class="install-banner-close" onclick="dismissInstallBanner()">
        √ó
      </button>
    </div>

    <!-- Settings Panel -->
    <div
      class="settings-overlay"
      id="settingsOverlay"
      onclick="toggleSettings()"
    ></div>
    <div class="settings-panel" id="settingsPanel">
      <div class="settings-header">
        <h2 class="settings-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg> Settings</h2>
        <button class="close-btn" onclick="toggleSettings()">√ó</button>
      </div>
      <div class="settings-content">
        <div class="settings-accordion open" id="proAccordion">
          <div class="accordion-header" onclick="toggleAccordion('proAccordion')">
            <span>Pro & Billing</span>
            <span class="accordion-meta" id="proAccordionMeta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group" id="proAccessSection">
              <div class="setting-group-title">LotriFlow Quit Pro</div>
              
              <!-- Pro Lifetime Member State -->
              <div id="proLifetimeCard" class="u-hidden">
                <div class="pro-card">
                  <div class="u-flex-center-12 u-mb-12">
                    <span class="u-fs-2rem u-color-accent-purple"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"></polyline></svg></span>
                    <div>
                      <div class="u-fw-700 u-fs-1-2">Lifetime Member</div>
                      <div class="u-fs-0-85 u-opacity-80">Permanent Pro Access</div>
                    </div>
                  </div>
                  <ul class="u-list-reset u-mb-16 u-fs-0-95 u-lh-1-8">
                    <li class="u-mb-8">‚úì Advanced Reports & Analytics</li>
                    <li class="u-mb-8">‚úì Craving Tracker & Pattern Analysis</li>
                    <li class="u-mb-8">‚úì Sync & Backup your data</li>
                    <li class="u-mb-8">‚úì Share your progress with friends</li>
                    <li>‚úì Support continued development</li>
                  </ul>
                  <div class="u-fs-0-85 u-opacity-70">
                    Thank you for supporting LotriFlow Quit!
                  </div>
                </div>
              </div>

              <!-- Pro Inactive State -->
              <div id="proInactiveCard">
                <div class="pro-card">
                  <div class="u-flex-center-12 u-mb-12">
                    <span class="u-fs-2rem"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></span>
                    <div class="u-fw-700 u-fs-1-2">Unlock Pro Features</div>
                  </div>
                  <ul class="u-list-reset u-mb-16 u-fs-0-95 u-lh-1-8">
                    <li class="u-mb-8">‚úì Advanced Reports & Analytics</li>
                    <li class="u-mb-8">‚úì Craving Tracker & Pattern Analysis</li>
                    <li class="u-mb-8">‚úì Sync & Backup your data</li>
                    <li class="u-mb-8">‚úì Share your progress with friends</li>
                    <li>‚úì Support continued development</li>
                  </ul>
                  
                  <!-- Lifetime Purchase CTA -->
                  <div onclick="ProAccess.purchaseLifetime()" class="pricing-option pricing-option-highlight u-pointer u-relative" style="max-width: 400px; margin: 20px auto;">
                    <div class="u-text-center u-pt-12 u-pb-12">
                      <div class="u-fw-700 u-fs-1-4 u-mb-8">üíé Lifetime Access</div>
                      <div class="u-fw-700 u-fs-2-0 u-color-accent-purple u-mb-8">$2.99</div>
                      <div class="u-fs-0-95 u-opacity-90 u-mb-8">Pay once, unlock forever</div>
                    </div>
                  </div>
                </div>
                <div class="u-text-center u-mt-12 u-fs-0-85 u-opacity-70">
                  Already purchased? <a href="#" onclick="ProAccess.restore(); return false;" class="u-color-primary u-underline">Restore here</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="syncAccordion">
          <div class="accordion-header" onclick="toggleAccordion('syncAccordion')">
            <span>Sync & Backup <span class="pro-badge">Pro</span></span>
            <span class="accordion-meta">Transfer or back up your data</span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
              <div class="setting-group-title u-flex-center-8">
                <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg></span>
                <span>Sync & Backup</span>
              </div>
              <div class="sync-section">
                <div class="sync-summary u-flex-center-8">
                  <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg></span>
                  <span>Your data stays on this device. Use these quick actions to move or back it up:</span>
                </div>
                <div class="sync-actions">
                  <button
                    class="btn btn-secondary btn-small"
                    onclick="generateShareCode()"
                  >
                    <span class="u-flex-center-6"><span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 16 12 12 8 16"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"></path></svg></span><span>Share Code</span></span>
                    <span class="sync-btn-desc">Device to device</span>
                  </button>
                  <button
                    class="btn btn-secondary btn-small"
                    onclick="showRestoreModal()"
                  >
                    <span class="u-flex-center-6"><span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span><span>Restore</span></span>
                    <span class="sync-btn-desc">Use a code</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="notificationsAccordion">
          <div class="accordion-header" onclick="toggleAccordion('notificationsAccordion')">
            <span>Notifications</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
              <div class="setting-item setting-item-dual">
                <div>
                  <div class="setting-label">Pause Notifications</div>
                  <div class="setting-desc">Mute reminders and alerts</div>
                </div>
                <div class="setting-control-row">
                <label class="toggle"
                  ><label for="notificationsMuted" class="sr-only">Pause notifications</label>
                  <input
                    type="checkbox"
                    id="notificationsMuted"
                    aria-label="Pause notifications"
                    title="Pause notifications"
                    placeholder="Pause notifications"
                    onchange="toggleNotificationMute()" /><span class="toggle-slider"></span
                  ></label>
              </div>
            </div>
          <div class="setting-group-title u-flex-center-8">
            <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></span>
            <span>Notifications</span>
          </div>
              <!-- Daily Reminder (Native iOS/Android) -->
              <div class="setting-item u-hidden" id="dailyReminderRow">
                <div>
                  <div class="setting-label">Daily Reminder</div>
                  <div class="setting-desc">Get a motivational reminder each day</div>
                </div>
                <label class="toggle"
                  ><input
                    type="checkbox"
                    id="dailyReminderEnabled"
                    aria-label="Enable daily reminder"
                    onchange="toggleDailyReminder()" /><span
                    class="toggle-slider"
                  ></span
                ></label>
              </div>
              <div class="setting-item u-hidden" id="reminderTimeRow">
                <div>
                  <div class="setting-label">Reminder Time</div>
                  <div class="setting-desc">When to receive your daily reminder</div>
                </div>
                <input 
                  type="time" 
                  id="reminderTime" 
                  value="09:00" 
                  aria-label="Daily reminder time"
                  onchange="updateReminderTime()"
                  class="time-input"
                />
              </div>
              <!-- Legacy Web Notifications -->
              <div class="setting-item" id="notificationsRow">
                <div>
                  <div class="setting-label">Push Notifications</div>
                  <div class="setting-desc">Get reminded when you can smoke</div>
                </div>
                <label class="toggle"
                  ><input
                    type="checkbox"
                    id="notificationsEnabled"
                    aria-label="Enable push notifications"
                    onchange="toggleNotifications()" /><span class="toggle-slider"></span
                ></label>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="feedbackAccordion">
          <div class="accordion-header" onclick="toggleAccordion('feedbackAccordion')">
            <span>App Feedback</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
              <div class="setting-item setting-item-dual">
                <div class="setting-label">App Feedback</div>
                <div class="setting-desc">Sound and vibration for in-app cues</div>
                <div class="setting-control-row">
                  <label class="toggle"
                    ><input
                      type="checkbox"
                      id="feedbackEnabled"
                      checked
                      aria-label="Enable app feedback sounds and vibration"
                      onchange="saveSettings()" /><span class="toggle-slider"></span
                  ></label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="toolsAccordion" style="display: none;">
          <div class="accordion-header" onclick="toggleAccordion('toolsAccordion')">
            <span>Tools & Features</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
              <div class="setting-group-title u-flex-center-8">
                <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-2.54 2.54a5 5 0 0 1-7.07 0L3.3 16.7a5 5 0 0 1 0-7.07l2.54-2.54a6 6 0 0 1 7.94-7.94l-3.77 3.77z"></path></svg></span>
                <span>Tools & Features</span>
              </div>
              <!-- Quit Plan moved to its own section and nav item; removed inline View Quit Plan in settings -->
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="goalsAccordion">
          <div class="accordion-header" onclick="toggleAccordion('goalsAccordion')">
            <span>Goals</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
          <div class="setting-group-title u-flex-center-8">
            <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg></span>
            <span>Goals</span>
          </div>
              <div class="setting-item">
                <div>
                  <div class="setting-label">Target Interval</div>
                  <div class="setting-desc">Minutes between cigarettes</div>
                </div>
                <div class="number-input-with-box">
                  <button onclick="adjustInterval(-5)">‚àí</button>
                  <input type="number" id="intervalInput" value="60" min="15" max="1440" step="5" onblur="if(this.value && this.value<15)this.value=15;if(this.value && this.value>1440)this.value=1440;" onchange="setIntervalFromInput()" aria-label="Target interval in minutes" />
                  <button onclick="adjustInterval(5)">+</button>
                </div>
              </div>
              <div class="setting-item">
                <div>
                  <div class="setting-label">Daily Limit</div>
                  <div class="setting-desc">Your daily smoking goal</div>
                </div>
                <div class="number-input-with-box">
                  <button onclick="adjustDailyLimit(-1)">‚àí</button>
                  <input type="number" id="dailyLimitInput" value="10" min="1" max="50" onblur="if(this.value && this.value<1)this.value=1;if(this.value && this.value>50)this.value=50;" onchange="setDailyLimitFromInput()" aria-label="Daily smoking limit" />
                  <button onclick="adjustDailyLimit(1)">+</button>
                </div>
              </div>
              <div class="setting-item">
                <div>
                  <div class="setting-label">Baseline</div>
                  <div class="setting-desc">Pre-quit smoking rate for tracking reduction</div>
                </div>
                <div class="number-input-with-box">
                  <button onclick="adjustBaseline(-1)">‚àí</button>
                  <input type="number" id="baselineInput" value="10" min="1" max="100" onblur="if(this.value && this.value<1)this.value=1;if(this.value && this.value>100)this.value=100;" onchange="setBaselineFromInput()" aria-label="Baseline cigarettes per day" />
                  <button onclick="adjustBaseline(1)">+</button>
                </div>
              </div>
              <div class="setting-item u-pointer" onclick="toggleCalculationDetails()">
                <div>
                  <div class="setting-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg> Show Calculation Details</div>
                  <div class="setting-desc">See how your metrics are calculated</div>
                </div>
                <span id="calcDetailsToggle" class="u-fs-20"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></span>
              </div>
              <div id="calculationDetails" class="calc-details">
                <div class="u-mb-12">
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg> Daily Average</strong><br>
                  <span id="calcDailyAvg" class="u-color-secondary"></span>
                </div>
                <div class="u-mb-12">
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 18 13.5 8.5 18 3 2 3 2 18 7 13"></polyline></svg> Reduction</strong><br>
                  <span id="calcReduction" class="u-color-secondary"></span>
                </div>
                <div class="u-mb-12">
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg> Money Saved</strong><br>
                  <span id="calcMoneySaved" class="u-color-secondary"></span>
                </div>
                <div class="u-mb-12">
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Avg Interval</strong><br>
                  <span id="calcAvgInterval" class="u-color-secondary"></span>
                </div>
                <div class="u-mb-12">
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> Today's Count</strong><br>
                  <span id="calcTodaysCount" class="u-color-secondary"></span>
                </div>
                <div class="u-mb-12">
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg> Streak</strong><br>
                  <span id="calcStreak" class="u-color-secondary"></span>
                </div>
                <div>
                  <strong class="u-color-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg> 7-Day Trend</strong><br>
                  <span id="calc7DayTrend" class="u-color-secondary"></span>
                </div>
              </div>
              <div class="setting-item">
                <div>
                  <div class="setting-label" id="autoIncreaseLabel">Auto-Increase</div>
                  <div class="setting-desc">Increase interval each successful day</div>
                </div>
                <label for="autoIncrease" class="sr-only" id="autoIncreaseHiddenLabel">Auto-Increase</label>
                <label class="toggle" for="autoIncrease">
                  <input
                    type="checkbox"
                    id="autoIncrease"
                    name="autoIncrease"
                    aria-label="Enable auto-increase"
                    aria-labelledby="autoIncreaseLabel autoIncreaseHiddenLabel"
                    title="Enable auto-increase"
                    onchange="saveSettings()" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="setting-item" id="autoIncreaseAmountContainer">
                <div>
                  <div class="setting-label">Auto-Increase Amount</div>
                  <div class="setting-desc">Minutes to add each successful day</div>
                </div>
                <div class="number-input-with-box">
                  <button onclick="adjustAutoIncrease(-5)">‚àí</button>
                  <input type="number" id="autoIncreaseInput" value="5" min="1" max="60" step="5" onblur="if(this.value && this.value<1)this.value=1;if(this.value && this.value>60)this.value=60;" onchange="setAutoIncreaseFromInput()" aria-label="Auto-increase amount in minutes" />
                  <button onclick="adjustAutoIncrease(5)">+</button>
                </div>
              </div>
              <div class="setting-item">
                <div>
                  <div class="setting-label">Quit Date</div>
                  <div class="setting-desc">Set your target quit day</div>
                </div>
                <input
                  type="date"
                  id="quitDateInput"
                  onchange="changeQuitDate()"
                  class="quit-date-input"
                  title="Set your target quit day"
                  placeholder="Select quit date"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="costAccordion">
          <div class="accordion-header" onclick="toggleAccordion('costAccordion')">
            <span>Cost</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
          <div class="setting-group-title u-flex-center-8">
            <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg></span>
            <span>Cost</span>
          </div>
              <div class="setting-item">
                <div>
                  <div class="setting-label">Currency</div>
                  <div class="setting-desc">Select your local currency</div>
                </div>
                <select
                  id="currencySelect"
                  aria-label="Currency"
                  onchange="changeCurrency()"
                  class="u-select"
                >
                  <option value="USD">USD ($)</option>
                  <option value="EUR">EUR (‚Ç¨)</option>
                  <option value="GBP">GBP (¬£)</option>
                  <option value="JPY">JPY (¬•)</option>
                  <option value="AUD">AUD (A$)</option>
                  <option value="CAD">CAD (C$)</option>
                  <option value="CHF">CHF</option>
                  <option value="CNY">CNY (¬•)</option>
                  <option value="INR">INR (‚Çπ)</option>
                  <option value="RUB">RUB (‚ÇΩ)</option>
                  <option value="BRL">BRL (R$)</option>
                  <option value="ZAR">ZAR (R)</option>
                  <option value="MXN">MXN ($)</option>
                  <option value="KRW">KRW (‚Ç©)</option>
                  <option value="TRY">TRY (‚Ç∫)</option>
                  <option value="PLN">PLN (z≈Ç)</option>
                  <option value="THB">THB (‡∏ø)</option>
                  <option value="IDR">IDR (Rp)</option>
                  <option value="MYR">MYR (RM)</option>
                  <option value="PHP">PHP (‚Ç±)</option>
                  <option value="VND">VND (‚Ç´)</option>
                  <option value="AED">AED</option>
                  <option value="SAR">SAR</option>
                  <option value="EGP">EGP (E¬£)</option>
                  <option value="NGN">NGN (‚Ç¶)</option>
                </select>
              </div>
              <div class="setting-item">
                <div><div class="setting-label">Pack Price</div></div>
                <div class="number-input-with-box">
                  <button onclick="adjustPackPrice(-0.5)">‚àí</button>
                  <input
                      type="number"
                      id="packPriceInput"
                      min="0.5"
                      max="100"
                      step="0.5"
                      value="8"
                      aria-label="Pack price"
                      title="Enter the price per pack"
                      placeholder="e.g. 8"
                      onblur="if(this.value && this.value<0.5)this.value=0.5;if(this.value && this.value>100)this.value=100;"
                      onchange="setPackPriceFromInput()"
                  />
                  <button onclick="adjustPackPrice(0.5)">+</button>
                </div>
              </div>
              <div class="setting-item">
                <div><div class="setting-label">Cigs per Pack</div></div>
                <div class="number-input-with-box">
                  <button onclick="adjustCigsPerPack(-1)">‚àí</button>
                  <input
                    type="number"
                    id="cigsPerPackInput"
                    min="10"
                    max="50"
                    step="1"
                    value="20"
                    aria-label="Cigarettes per pack"
                    onblur="if(this.value && this.value<10)this.value=10;if(this.value && this.value>50)this.value=50;"
                    onchange="setCigsPerPackFromInput()"
                  />
                  <button onclick="adjustCigsPerPack(1)">+</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="setting-group u-hidden">
          <div class="setting-group-title u-flex-center-8">
            <span class="setting-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="4"></circle><line x1="4.93" y1="4.93" x2="9.07" y2="9.07"></line><line x1="14.93" y1="14.93" x2="19.07" y2="19.07"></line><line x1="14.93" y1="9.07" x2="19.07" y2="4.93"></line><line x1="4.93" y1="19.07" x2="9.07" y2="14.93"></line></svg></span>
            <span>Coach</span>
          </div>
          <div
            class="setting-item card-llm-green u-flex-col-start"
          >
            <div class="setting-label u-flex-center-8">
                          <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></span>
                          <span>Coach Status</span>
                        </div>
            <div id="llmStatus" class="u-fs-0-85 u-color-accent-green u-mt-8 u-fw-600">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.93"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Intelligent coach enabled
                        </div>
            <div
              class="u-fs-0-75 u-color-secondary u-mt-4 u-lh-1-4"
            >
              Coach uses context-aware motivational messages. Works 100%
              offline!
            </div>
          </div>

          <div class="setting-item u-opacity-60">
            <div>
              <div id="llmExternalLabel" class="setting-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="15" x2="4" y2="15"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="15" x2="23" y2="15"></line></svg> Advanced: External LLM API</div>
              <div class="setting-desc u-fs-0-75" id="llmExternalDesc">
                Optional - use HuggingFace for varied responses
              </div>
            </div>
            <label class="toggle">
              <input
                id="llmEnabled"
                type="checkbox"
                aria-labelledby="llmExternalLabel"
                aria-describedby="llmExternalDesc"
                onchange="toggleLLM()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div
            class="setting-item card-llm-orange u-flex-col-start u-hidden"
            id="llmApiKeySection"
          >
            <div class="u-w-100">
              <div class="setting-label">HuggingFace API Key</div>
              <div
                class="setting-desc u-fs-0-75 u-mb-8"
              >
                <a
                  href="https://huggingface.co/settings/tokens"
                  target="_blank"
                  rel="noopener"
                  class="huggingface-link"
                >
                  Get free API key ‚Üí
                </a>
              </div>
              <input
                id="llmApiKey"
                type="password"
                placeholder="hf_..."
                class="u-input-compact"
                onchange="saveLLMApiKey()"
              />
              <!-- Test API button removed for production -->
              <div
                id="llmApiStatus"
                class="u-fs-0-75 u-color-muted u-mt-6"
              >
                Enter key and click Test
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="installAccordion">
          <div class="accordion-header" onclick="toggleAccordion('installAccordion')">
            <span>Install App</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group" id="installSection">
              <div class="setting-group-title">Install App</div>
              <div class="setting-item">
                <div class="u-flex-1">
                  <div class="setting-label">Add to Home Screen</div>
                  <div class="setting-desc">Works offline, like a native app</div>
                  <div
                    class="setting-desc u-mt-8 u-fs-0-7 u-opacity-70"
                  >
                    <strong>Chrome:</strong> Look for install icon in address bar,
                    or use menu (‚ãÆ) ‚Üí "Install LotriFlow Quit"<br />
                    <strong>iOS Safari:</strong> Tap Share ‚Üí "Add to Home Screen"
                  </div>
                </div>
                <button class="btn btn-primary btn-tiny" onclick="installPWA()">
                  Install
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="aboutAccordion">
          <div class="accordion-header" onclick="toggleAccordion('aboutAccordion')">
            <span>About</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
              <!-- App Header -->
              <div class="about-header">
                <div class="about-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                </div>
                <div class="about-app-name">LotriFlow Quit</div>
                <div class="about-version" id="aboutVersion">Version 1.0.6 (Build 6)</div>
                <div class="about-description">
                  Your personal smoking cessation companion. Track your progress, manage cravings, and achieve your quit goals with evidence-based tools and intelligent support.
                </div>
              </div>

              <!-- Info Cards -->
              <div class="about-section">
                <div class="about-info-card">
                  <div class="about-info-label">Developer</div>
                  <div class="about-info-value">LotriFlow</div>
                  <button class="btn btn-secondary btn-small u-mt-12 u-w-full" onclick="window.open('https://lotriflow.com', '_blank')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="u-mr-6"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                    Visit Website
                  </button>
                </div>

                <div class="about-info-card">
                  <div class="about-info-label">Contact & Support</div>
                  <div class="about-info-value">hello@lotriflow.com</div>
                  <button class="btn btn-secondary btn-small u-mt-12 u-w-full" onclick="openSupport()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="u-mr-6"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                    Send Email
                  </button>
                </div>
              </div>

              <!-- Legal Links -->
              <div class="about-section">
                <div class="about-section-title">Legal</div>
                <div class="about-legal-links">
                  <button class="about-legal-btn" onclick="showModal('termsModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    <span>Terms of Service</span>
                  </button>
                  <button class="about-legal-btn" onclick="showModal('privacyModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                    <span>Privacy Policy</span>
                  </button>
                </div>
              </div>

              <!-- Medical Disclaimer -->
              <div class="about-disclaimer">
                <div class="about-disclaimer-icon">‚ö†Ô∏è</div>
                <div class="about-disclaimer-content">
                  <div class="about-disclaimer-title">Important Medical Disclaimer</div>
                  <div class="about-disclaimer-text">
                    LotriFlow Quit is not responsible for any loss, harm, or outcomes from using this app. This is just a tool and by no means guaranteed to help you stop smoking‚Äîit's entirely your own choice and responsibility. Consult a healthcare professional for quitting smoking. Not medical advice.
                  </div>
                </div>
              </div>

              <!-- Copyright -->
              <div class="about-footer">
                ¬© 2024-2025 LotriFlow<br>
                Made with care for your health
              </div>
            </div>
          </div>
        </div>

        <div class="settings-accordion" id="dangerAccordion">
          <div class="accordion-header" onclick="toggleAccordion('dangerAccordion')">
            <span>Danger Zone</span>
            <span class="accordion-meta"></span>
            <span class="accordion-icon">‚åÑ</span>
          </div>
          <div class="accordion-body">
            <div class="setting-group">
              <div class="setting-group-title">Danger Zone</div>
              <div class="setting-item">
                <div><div class="setting-label">Reset All Data</div></div>
                <button class="btn btn-danger btn-tiny" onclick="resetProgress()">
                  Reset
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- App Version -->
        <div class="app-meta">
          <div class="app-meta-text">
            <div id="appVersion" class="app-meta-version">LotriFlow Quit v1.0.1</div>
            <div id="appBuild" class="app-meta-build">Build 5</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" role="status" aria-live="polite">
      <span class="toast-icon" aria-hidden="true"></span>
      <span class="toast-message" id="toastMessage">Saved!</span>
    </div>

    <!-- Modals -->
    <!-- Onboarding Wizard -->
    <div class="modal-overlay" id="onboardingModal">
      <div class="modal onboarding-wizard">
        
        <!-- Progress Indicator -->
        <div class="wizard-progress">
          <div class="wizard-step active" data-step="1">1</div>
          <div class="wizard-step" data-step="2">2</div>
          <div class="wizard-step" data-step="3">3</div>
          <div class="wizard-step" data-step="4">4</div>
        </div>
        
        <!-- Step 1: Welcome -->
        <div class="wizard-slide active" id="wizardStep1">
          <div class="wizard-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></div>
          <div class="wizard-title">Welcome to LotriFlow Quit</div>
          <div class="wizard-subtitle">Your journey to a healthier life starts here. Let's set up your profile in a few quick steps.</div>

          <div class="wizard-input-group">
            <div class="wizard-info-box">
              <div class="wizard-info-title">How LotriFlow Quit Works:</div>
              <div class="wizard-info-text">
                ‚Ä¢ Track when you smoke to see patterns<br>
                ‚Ä¢ Set goals to gradually reduce smoking<br>
                ‚Ä¢ See your health improve in real-time<br>
                ‚Ä¢ Earn badges as you make progress<br>
                ‚Ä¢ All data stays private on your device
              </div>
            </div>
          </div>

          <button class="wizard-btn-primary" onclick="nextWizardStep(2)">Get Started</button>
        </div>
        
        <!-- Step 2: Smoking Habits -->
        <div class="wizard-slide" id="wizardStep2">
          <div class="wizard-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path></svg></div>
          <div class="wizard-title">Your Smoking Habits</div>
          <div class="wizard-subtitle">This helps us track your progress accurately</div>

          <div class="wizard-input-group">
            <label>How many cigarettes do you smoke per day?</label>
            <div class="wizard-help-text">Your baseline - we'll track reduction from this number</div>
            <div class="wizard-stepper">
              <button class="stepper-btn" onclick="adjustStepper('setupDailySmokes', -1)">‚àí</button>
              <input type="number" id="setupDailySmokes" value="10" min="1" max="100" onblur="if(this.value && this.value<1)this.value=1;if(this.value && this.value>100)this.value=100;" aria-label="Daily cigarettes baseline" />
              <button class="stepper-btn" onclick="adjustStepper('setupDailySmokes', 1)">+</button>
            </div>
          </div>

          <div class="wizard-input-group">
            <label>Daily smoking limit</label>
            <div class="wizard-help-text">Your daily goal - track if you stay under this limit</div>
            <div class="wizard-stepper">
              <button class="stepper-btn" onclick="adjustStepper('setupDailyLimit', -1)">‚àí</button>
              <input type="number" id="setupDailyLimit" value="10" min="1" max="50" onblur="if(this.value && this.value<1)this.value=1;if(this.value && this.value>50)this.value=50;" aria-label="Daily smoking limit setup" />
              <button class="stepper-btn" onclick="adjustStepper('setupDailyLimit', 1)">+</button>
            </div>
          </div>

          <div class="wizard-input-group">
            <label>Target time between cigarettes (minutes)</label>
            <div class="wizard-help-text">Start with a realistic goal - you can increase it later</div>
            <div class="wizard-stepper">
              <button class="stepper-btn" onclick="adjustStepper('setupInterval', -15)">‚àí</button>
              <input type="number" id="setupInterval" value="60" min="15" max="1440" step="15" onblur="if(this.value && this.value<15)this.value=15;if(this.value && this.value>1440)this.value=1440;" aria-label="Target interval minutes setup" />
              <button class="stepper-btn" onclick="adjustStepper('setupInterval', 15)">+</button>
            </div>
          </div>

          <div class="wizard-nav">
            <button class="wizard-btn-secondary" onclick="prevWizardStep(1)">Back</button>
            <button class="wizard-btn-primary" onclick="nextWizardStep(3)">Continue</button>
          </div>
        </div>
        
        <!-- Step 3: Goals & Finances -->
        <div class="wizard-slide" id="wizardStep3">
          <div class="wizard-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg></div>
          <div class="wizard-title">Your Goals</div>
          <div class="wizard-subtitle">Set your quit date and track your savings</div>
          
          <div class="wizard-input-group">
            <label>When do you want to quit?</label>
            <input type="date" class="wizard-input" id="setupQuitDate" aria-label="Quit date" />
          </div>
          
          <div class="wizard-input-group">
            <label>Price per pack</label>
            <div class="wizard-currency-input">
              <select id="setupCurrency" class="wizard-select" aria-label="Setup currency">
                <option value="USD">$ USD</option>
                <option value="EUR">‚Ç¨ EUR</option>
                <option value="GBP">¬£ GBP</option>
                <option value="AUD">A$ AUD</option>
                <option value="CAD">C$ CAD</option>
                <option value="ZAR">R ZAR</option>
              </select>
              <input type="number" class="wizard-input" id="setupPackPrice" value="8" min="1" max="100" step="0.5" onblur="if(this.value && this.value<0.5)this.value=0.5;if(this.value && this.value>100)this.value=100;" aria-label="Setup pack price" />
            </div>
          </div>
          
          <div class="wizard-input-group">
            <label>Cigarettes per pack</label>
            <div class="wizard-stepper">
              <button class="stepper-btn" onclick="adjustStepper('setupCigsPerPack', -1)">‚àí</button>
              <input type="number" id="setupCigsPerPack" value="20" min="10" max="30" onblur="if(this.value && this.value<10)this.value=10;if(this.value && this.value>30)this.value=30;" aria-label="Setup cigarettes per pack" />
              <button class="stepper-btn" onclick="adjustStepper('setupCigsPerPack', 1)">+</button>
            </div>
          </div>
          
          <div class="wizard-nav">
            <button class="wizard-btn-secondary" onclick="prevWizardStep(2)">Back</button>
            <button class="wizard-btn-primary" onclick="nextWizardStep(4)">Continue</button>
          </div>
        </div>
        
        <!-- Step 4: Terms & Start -->
        <div class="wizard-slide" id="wizardStep4">
          <div class="wizard-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></div>
          <div class="wizard-title">Almost There!</div>
          <div class="wizard-subtitle">Review and accept to begin your smoke-free journey</div>
          
          <div class="wizard-summary">
            <div class="summary-item">
              <span class="summary-label">Daily cigarettes</span>
              <span class="summary-value" id="summaryDaily">10</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Target interval</span>
              <span class="summary-value" id="summaryInterval">60 min</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Quit date</span>
              <span class="summary-value" id="summaryQuitDate">Today</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Pack price</span>
              <span class="summary-value" id="summaryPrice">$8.00</span>
            </div>
          </div>
          
          <div class="wizard-agreements">
            <label class="wizard-checkbox">
              <input type="checkbox" id="agreeTerms" />
              <span>I agree to the <a href="#" onclick="showModal('termsModal')">Terms of Service</a></span>
            </label>
            <label class="wizard-checkbox">
              <input type="checkbox" id="agreePrivacy" />
              <span>I agree to the <a href="#" onclick="showModal('privacyModal')">Privacy Policy</a></span>
            </label>
          </div>
          
          <div class="agreement-error" id="agreementError">
            Please agree to the Terms of Service and Privacy Policy to continue.
          </div>
          
          <div class="wizard-nav">
            <button class="wizard-btn-secondary" onclick="prevWizardStep(3)">Back</button>
            <button class="wizard-btn-start" onclick="completeOnboarding()">
              Start My Journey
            </button>
          </div>
        </div>
        
      </div>
    </div>

    <div class="modal-overlay" id="restoreModal">
      <div class="modal">
        <div class="modal-title">Restore Data <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg></div>
        <div class="modal-subtitle">Enter your share code</div>
        <div style="background: rgba(255, 152, 0, 0.1); border: 1px solid rgba(255, 152, 0, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 0.9rem; color: rgba(255, 152, 0, 0.9); display: flex; align-items: start; gap: 10px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 2px;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
          <div><strong>Warning:</strong> This will overwrite your current progress. Make sure you have the correct code before restoring.</div>
        </div>
        <div class="modal-input-group" style="position: relative;">
          <input
            type="text"
            class="modal-input"
            id="restoreCodeInput"
            placeholder="Paste code here..."
            style="padding-right: 40px;"
          />
          <button
            type="button"
            onclick="document.getElementById('restoreCodeInput').value = ''; document.getElementById('restoreCodeInput').focus();"
            style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; display: flex; align-items: center; opacity: 0.6; transition: opacity 0.2s;"
            onmouseover="this.style.opacity='1'"
            onmouseout="this.style.opacity='0.6'"
            aria-label="Clear"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
        <div class="u-flex-gap-10">
          <button
            class="btn btn-secondary u-flex-1"
            onclick="closeModal('restoreModal')"
          >
            Cancel
          </button>
          <button
            class="btn btn-primary u-flex-1"
            onclick="restoreFromCode()"
          >
            Restore
          </button>
        </div>
      </div>
    </div>

    <!-- Share Modal - Compact -->
    <div class="modal-overlay" id="shareModal">
      <div class="modal share-modal">
        <button class="share-modal-close" onclick="closeModal('shareModal')">√ó</button>
        
        <div class="share-header">
          <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"></polyline><path d="M20 12V7H4v5"></path><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></svg></span>
          <div class="share-title">Share Progress</div>
        </div>

        <div class="share-card">
          <div class="share-text" id="shareText">
            I've been smoke-free for 0 hours!
          </div>
          <div class="share-stats">
            <div class="share-stat">
              <div class="share-stat-value" id="shareAvoided">0</div>
              <div class="share-stat-label">Avoided</div>
            </div>
            <div class="share-stat">
              <div class="share-stat-value" id="shareSaved">$0</div>
              <div class="share-stat-label">Saved</div>
            </div>
          </div>
        </div>

        <div class="share-buttons">
          <button class="share-btn" onclick="shareToTwitter()">ùïè</button>
          <button class="share-btn" onclick="shareToFacebook()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></button>
          <button class="share-btn" onclick="shareToWhatsApp()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></button>
          <button class="share-btn" onclick="copyShareText()"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
        </div>
      </div>
    </div>

    <div class="modal-overlay breathing-modal-overlay" id="breathingModal">
      <div class="breathing-modal">
        <div class="breathing-header">
          <div class="breathing-technique-name" id="breathingTitle">Breathing Exercise</div>
          <div class="breathing-progress" id="breathingProgress">Cycle 1</div>
        </div>

        <div class="breathing-container">
          <div class="breathing-background" id="breathingBackground"></div>
          <div class="breathing-circle-wrapper">
            <div class="breathing-circle" id="breathingCircle">
              <div class="breathing-circle-inner">
                <div class="breathing-timer" id="breathingTimer">4</div>
              </div>
            </div>
          </div>
        </div>

        <div class="breathing-instruction-container">
          <div class="breathing-instruction" id="breathingInstruction">Get Ready...</div>
        </div>

        <button
          class="btn btn-secondary breathing-close-btn"
          onclick="closeModal('breathingModal')"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Breathing Technique Selector Modal -->
    <div class="modal-overlay" id="breathingSelectorModal">
      <div class="modal">
        <div class="modal-title">Choose Breathing Technique <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path></svg></div>
        <div class="modal-subtitle u-mb-20">
          Select a technique to help manage cravings and stress
        </div>

        <div class="u-grid-gap-12 u-mb-20">
          <button
            class="breathing-technique-card"
            onclick="selectBreathingTechnique('478')"
          >
            <div class="u-flex-center-12">
              <div class="u-fs-2rem"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path></svg></div>
              <div class="u-text-left u-flex-1">
                <div class="u-fw-600 u-fs-1-0 u-mb-4">
                  4-7-8 Breathing
                </div>
                <div class="u-fs-0-8 u-color-secondary">
                  Classic 4-7-8 breathing exercise
                </div>
              </div>
            </div>
          </button>

          <button
            class="breathing-technique-card"
            onclick="selectBreathingTechnique('box')"
          >
            <div class="u-flex-center-12">
              <div class="u-fs-2rem"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg></div>
              <div class="u-text-left u-flex-1">
                <div class="u-fw-600 u-fs-1-0 u-mb-4">
                  Box Breathing
                </div>
                <div class="u-fs-0-8 u-color-secondary">
                  Tactical breathing technique for stress control
                </div>
              </div>
            </div>
          </button>

          <button
            class="breathing-technique-card"
            onclick="selectBreathingTechnique('alternate')"
          >
            <div class="u-flex-center-12">
              <div class="u-fs-2rem"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.5 10a9 9 0 0 1 16.1-4.3L23 10M1 14l3.4-3.4A9 9 0 0 1 20.5 14"></path></svg></div>
              <div class="u-text-left u-flex-1">
                <div class="u-fw-600 u-fs-1-0 u-mb-4">
                  Alternate Nostril
                </div>
                <div class="u-fs-0-8 u-color-secondary">
                  Balances energy and reduces anxiety
                </div>
              </div>
            </div>
          </button>

          <button
            class="breathing-technique-card"
            onclick="selectBreathingTechnique('quick')"
          >
            <div class="u-flex-center-12">
              <div class="u-fs-2rem"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg></div>
              <div class="u-text-left u-flex-1">
                <div class="u-fw-600 u-fs-1-0 u-mb-4">
                  Quick Reset
                </div>
                <div class="u-fs-0-8 u-color-secondary">
                  Fast stress relief for intense moments
                </div>
              </div>
            </div>
          </button>
        </div>

        <button
          class="btn btn-secondary u-w-full"
          onclick="closeModal('breathingSelectorModal')"
        >
          Cancel
        </button>
      </div>
    </div>

    <!-- Quit Plan modal removed; content moved to `#quitPlanSection` -->

    <!-- Crisis Support Modal -->
    <div class="modal-overlay" id="crisisModal">
      <div class="modal">
        <div class="modal-title" id="crisisTitle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> Crisis Support Resources</div>
        <div class="modal-subtitle" id="crisisMessage">
          If you're struggling right now, remember you're not alone.
        </div>
        <ul id="crisisResources">
          <!-- Resources will be populated by JavaScript -->
        </ul>
        <div class="crisis-modal-buttons">
          <button class="btn btn-secondary" onclick="closeModal('crisisModal')">
            Close
          </button>
          <button class="btn" onclick="showBreathingSelector()">
            Start Breathing Exercise
          </button>
        </div>
      </div>
    </div>

    <!-- Log Cigarette Confirmation Modal -->
    <div class="modal-overlay" id="smokeConfirmModal">
      <div class="modal">
        <div class="modal-title" id="smokeConfirmTitle">Log a cigarette?</div>
        <div class="modal-subtitle" id="smokeConfirmMessage">
          This will reset your quit timer.
        </div>
        <div class="u-flex-end-gap-10 u-mt-16">
          <button class="btn btn-secondary" onclick="cancelLogCigarette()">
            Cancel
          </button>
          <button
            class="btn btn-danger"
            id="smokeConfirmPrimary"
            onclick="confirmLogCigarette()"
          >
            Yes, I smoked
          </button>
        </div>
      </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal-overlay" id="termsModal">
      <div
        class="modal modal-scroll"
      >
        <div class="modal-title">
          Terms of Service
          <button
            class="close-btn modal-close-compact"
            onclick="closeModal('termsModal')"
          >
            √ó
          </button>
        </div>
        <div class="legal-content legal-scroll">
          <h2 class="legal-h2">
            Terms of Service for LotriFlow Quit
          </h2>
          <p class="legal-p-spaced">
            <strong>Last Updated:</strong> January 2025
          </p>

          <h3 class="legal-h3">
            1. Acceptance of Terms
          </h3>
          <p>
            By using LotriFlow Quit ("the App"), you agree to these Terms
            of Service. If you do not agree, please do not use the App.
          </p>

          <h3
            class="legal-h3"
          >
            2. Description of Service
          </h3>
          <p>
            LotriFlow Quit is a personal tool designed to help users track
            their quit-smoking journey. It is not medical advice, treatment, or
            a guaranteed method to stop smoking.
          </p>

          <h3
            class="legal-h3"
          >
            3. No Medical Advice
          </h3>
          <p>
            The App is for informational purposes only. It does not provide
            medical, psychological, or professional advice. Quitting smoking can
            have serious health implications. Consult a healthcare professional
            before making any changes to your health habits.
          </p>

          <h3
            class="legal-h3"
          >
            4. User Responsibility
          </h3>
          <p>
            You are solely responsible for your use of the App and any decisions
            related to quitting smoking. The App does not guarantee success, and
            results may vary. Use of the App is entirely at your own risk.
          </p>

          <h3
            class="legal-h3"
          >
            5. Limitation of Liability
          </h3>
          <p>
            LotriFlow Quit and its developers are not responsible for any loss,
            damage, or harm resulting from your use of the App, including but
            not limited to health issues, addiction relapse, or any other
            consequences. The App is provided "as is" without warranties of any
            kind.
          </p>

          <h3
            class="legal-h3"
          >
            6. Data Privacy
          </h3>
          <p>
            Your data is stored locally on your device. We do not collect,
            store, or share personal data. See our Privacy Policy for more
            details.
          </p>

          <h3
            class="legal-h3"
          >
            7. In-App Purchases
          </h3>
          <p>
            The App offers optional Pro features through in-app purchases. All purchases 
            are processed by Apple and subject to Apple's terms and conditions. Prices 
            are displayed in your local currency. Purchases are non-refundable except 
            as required by applicable law or Apple's refund policies. Contact Apple 
            Support for refund requests.
          </p>

          <h3
            class="legal-h3"
          >
            8. Health Information Disclaimer
          </h3>
          <p>
            Health recovery timelines and milestones shown in the App are based on 
            general medical research and averages. Individual results vary significantly 
            based on smoking history, health conditions, and other factors. These 
            timelines are estimates for motivational purposes only and should not be 
            interpreted as personal medical predictions.
          </p>

          <h3
            class="legal-h3"
          >
            9. Apple App Store Terms
          </h3>
          <p>
            This App is licensed, not sold, to you. Your use is subject to Apple's 
            Licensed Application End User License Agreement. Apple has no obligation 
            to provide maintenance, support, or warranty for the App. Apple is not 
            responsible for any claims related to the App.
          </p>

          <h3
            class="legal-h3"
          >
            10. Governing Law
          </h3>
          <p>
            These terms shall be governed by the laws applicable in your 
            jurisdiction. Any disputes shall be resolved in accordance with 
            the applicable local laws where you reside.
          </p>

          <h3
            class="legal-h3"
          >
            11. Changes to Terms
          </h3>
          <p>
            We may update these terms at any time. Continued use of the App
            constitutes acceptance of the updated terms.
          </p>

          <h3
            class="legal-h3"
          >
            12. Contact
          </h3>
          <p>
            For questions, contact us at hello@lotriflow.com or use the feedback
            options in the app settings.
          </p>

          <p>¬© 2025 <span class="logo-lotri">lotri</span><span class="logo-flow">flow</span>. All rights reserved.</p>
        </div>
        <div class="modal-buttons">
          <button
            class="btn btn-secondary u-btn-pad-8-16"
            onclick="closeModal('termsModal')"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div class="modal-overlay" id="privacyModal">
      <div
        class="modal modal-scroll"
      >
        <div class="modal-title">
          Privacy Policy
          <button
            class="close-btn modal-close-compact"
            onclick="closeModal('privacyModal')"
          >
            √ó
          </button>
        </div>
        <div class="legal-content">
          <h2 class="legal-h2">
            Privacy Policy for LotriFlow Quit
          </h2>
          <p class="legal-p-spaced">
            <strong>Last Updated:</strong> January 2025
          </p>

          <h3
            class="legal-h3"
          >
            1. Information We Collect
          </h3>
          <p>
            We do not collect, store, or transmit any personal information. All
            data (such as quit dates, milestones, and preferences) is stored
            locally on your device using browser storage or Capacitor
            Preferences.
          </p>

          <h3
            class="legal-h3"
          >
            2. How We Use Information
          </h3>
          <p>
            Data is used solely for the App's functionality on your device. We
            do not access, analyze, or share your data.
          </p>

          <h3
            class="legal-h3"
          >
            3. Data Sharing
          </h3>
          <p>
            We do not share, sell, or disclose your data to third parties. Your
            information remains private and on-device.
          </p>

          <h3
            class="legal-h3"
          >
            4. Data Security
          </h3>
          <p>
            Since data is stored locally, security depends on your device's
            protection. We recommend using device security features.
          </p>

          <h3
            class="legal-h3"
          >
            5. Children's Privacy
          </h3>
          <p>
            This App is intended for adults of legal smoking age, which varies 
            by country (typically 18-21 years). As a smoking cessation tool, 
            this App is designed to help users quit smoking. We do not knowingly 
            collect data from anyone, including minors.
          </p>

          <h3
            class="legal-h3"
          >
            6. Changes to This Policy
          </h3>
          <p>We may update this policy. Check back periodically for changes.</p>

          <h3
            class="legal-h3"
          >
            7. In-App Purchases
          </h3>
          <p>
            Pro features are available through in-app purchases processed by Apple. 
            Apple collects payment information as per their privacy policy. We do not 
            have access to your payment details. Purchase history is stored locally 
            on your device and synced via your Apple ID.
          </p>

          <h3
            class="legal-h3"
          >
            8. Contact Us
          </h3>
          <p>
            For privacy questions, contact us at hello@lotriflow.com or use the
            feedback options in the app settings.
          </p>

          <p>¬© 2025 <span class="logo-lotri">lotri</span><span class="logo-flow">flow</span>. All rights reserved.</p>
        </div>
        <div class="modal-buttons">
          <button
            class="btn btn-secondary u-btn-pad-8-16"
            onclick="closeModal('privacyModal')"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal-overlay" id="resetModal">
      <div class="modal reset-modal" style="max-width: 440px">
        <div class="reset-header">
          <div class="reset-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"></polygon><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
          </div>
          <div>
            <div class="modal-title reset-title">Nuclear Reset</div>
            <div class="reset-subtitle">
              This will permanently delete <strong>ALL</strong> your data:
            </div>
          </div>
        </div>

        <ul class="reset-list">
          <li>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span>All cigarette logs</span>
          </li>
          <li>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span>All achievements & badges</span>
          </li>
          <li>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span>Progress statistics</span>
          </li>
          <li>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span>Settings & preferences</span>
          </li>
          <li>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            <span>Streak & milestones</span>
          </li>
        </ul>

        <div class="reset-input-card">
          <div class="reset-label">
            Type RESET to confirm
          </div>
          <input
            type="text"
            id="resetConfirmInput"
            placeholder="Type RESET in all caps"
            class="reset-input"
            onkeyup="if(event.key==='Enter' && this.value==='RESET') confirmReset()"
          />
        </div>

        <div class="reset-actions">
          <button
            class="btn btn-secondary"
            onclick="closeModal('resetModal'); document.getElementById('resetConfirmInput').value = '';"
          >
            Cancel
          </button>
          <button
            class="btn btn-danger reset-btn-danger"
            onclick="confirmReset()"
          >
            Reset Everything
          </button>
        </div>

        <div class="reset-warning">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> This action cannot be undone
        </div>
      </div>
    </div>

    <!-- Cigarette Animation Container -->
    <div id="cigarette-animation-container"></div>

    <!-- Capacitor Core (automatically included when built with Capacitor CLI) -->
    <script src="capacitor.js" onerror="console.log('[Web] Capacitor.js not found - running in web mode')"></script>
    <!-- Load stats helpers before app.js for browser global access -->
    <script type="module" src="src/utils/stats.js"></script>
    <!-- Provide build-time metadata defaults -->
    <script src="src/app-metadata.js"></script>
    <script src="src/state.js?v=3"></script>
    <script src="src/milestones.js"></script>
    <script src="src/timer.js"></script>
    <script src="src/notifications.js"></script>
    <script src="src/ui.js"></script>
    <!-- For web testing: Capacitor gracefully falls back to localStorage -->
    <script src="src/app.js?v=23"></script>
    <script src="src/payments.js?v=21"></script>
  </body>
</html>
