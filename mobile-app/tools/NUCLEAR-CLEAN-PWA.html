<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NUCLEAR PWA CLEANUP</title>
  <style>
    body {
      font-family: monospace;
      background: #000;
      color: #0f0;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    button {
      background: #f00;
      color: #fff;
      border: 2px solid #fff;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 5px;
      font-family: monospace;
    }
    button:hover {
      background: #a00;
    }
    #log {
      background: #111;
      padding: 15px;
      margin-top: 20px;
      border: 2px solid #0f0;
      min-height: 300px;
      max-height: 500px;
      overflow-y: auto;
    }
    .error { color: #f00; }
    .success { color: #0f0; }
    .warning { color: #ff0; }
  </style>
</head>
<body>
  <h1>üî• NUCLEAR PWA CLEANUP üî•</h1>
  <p>This will COMPLETELY remove ALL PWA installations and cached data.</p>

  <button onclick="nuclearClean()">üß® NUCLEAR CLEAN EVERYTHING</button>
  <button onclick="location.reload()">üîÑ Reload Page</button>
  <button onclick="window.open('index.html', '_blank')">üì± Open App (New Tab)</button>

  <div id="log"></div>

  <script>
    const log = document.getElementById('log');

    function addLog(msg, type = 'info') {
      const line = document.createElement('div');
      line.className = type;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      log.appendChild(line);
      log.scrollTop = log.scrollHeight;
      console.log(msg);
    }

    async function nuclearClean() {
      addLog('üî• STARTING NUCLEAR CLEANUP...', 'warning');

      try {
        // 1. Unregister ALL service workers
        addLog('Step 1: Unregistering ALL service workers...', 'warning');
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          addLog(`Found ${registrations.length} service worker(s)`, 'info');

          for (let registration of registrations) {
            await registration.unregister();
            addLog(`‚úì Unregistered: ${registration.scope}`, 'success');
          }
        }

        // 2. Clear ALL caches
        addLog('Step 2: Clearing ALL caches...', 'warning');
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          addLog(`Found ${cacheNames.length} cache(s)`, 'info');

          for (let cacheName of cacheNames) {
            await caches.delete(cacheName);
            addLog(`‚úì Deleted cache: ${cacheName}`, 'success');
          }
        }

        // 3. Clear localStorage
        addLog('Step 3: Clearing localStorage...', 'warning');
        const localStorageKeys = Object.keys(localStorage);
        addLog(`Found ${localStorageKeys.length} localStorage item(s)`, 'info');
        localStorage.clear();
        addLog('‚úì localStorage cleared', 'success');

        // 4. Clear sessionStorage
        addLog('Step 4: Clearing sessionStorage...', 'warning');
        sessionStorage.clear();
        addLog('‚úì sessionStorage cleared', 'success');

        // 5. Clear IndexedDB
        addLog('Step 5: Clearing IndexedDB...', 'warning');
        if ('indexedDB' in window) {
          const databases = await indexedDB.databases();
          for (let db of databases) {
            indexedDB.deleteDatabase(db.name);
            addLog(`‚úì Deleted database: ${db.name}`, 'success');
          }
        }

        addLog('', 'info');
        addLog('üéâ NUCLEAR CLEANUP COMPLETE!', 'success');
        addLog('', 'info');
        addLog('NOW DO THIS MANUALLY:', 'warning');
        addLog('1. Close ALL Edge windows/tabs', 'warning');
        addLog('2. Open Edge Settings (edge://settings/)', 'warning');
        addLog('3. Go to: Cookies and site permissions ‚Üí Manage and delete cookies', 'warning');
        addLog('4. Search for "localhost" and DELETE ALL', 'warning');
        addLog('5. Go to: edge://apps/', 'warning');
        addLog('6. UNINSTALL any BreatheFree apps', 'warning');
        addLog('7. Restart Edge completely', 'warning');
        addLog('8. Open: http://localhost:8080', 'warning');
        addLog('9. Try installing PWA again', 'warning');

      } catch (err) {
        addLog(`‚ùå ERROR: ${err.message}`, 'error');
        console.error(err);
      }
    }

    // Auto-run on load
    addLog('Ready. Click NUCLEAR CLEAN to start.', 'info');
    addLog('Current origin: ' + location.origin, 'info');
    addLog('User agent: ' + navigator.userAgent, 'info');
  </script>
</body>
</html>
